<template>
    <div class="page">
        <div class="navbar">
            <div class="navbar-inner sliding">
                <div class="left">
                    <a href="#" class="link back">
                        <i class="icon icon-back"></i>
                        <span class="ios-only">Back</span>
                    </a>
                </div>
                <div class="title">Your Booking</div>
            </div>
        </div>
        <div class="page-content">
            <form action="pages/editbookings.html" class="form-ajax-submit" id="my-form" method="post">


                <div class="block-header"><b>Vehicle Booking Form</b></div>
                <!--<form class="list" id="my-form">-->
                <ul>

                    <!--<li>-->
                    <!--<div class="item-content item-input">-->
                    <!--<div class="item-inner">-->
                    <!--&lt;!&ndash;<div class="item-title item-label">E-mail</div>&ndash;&gt;-->
                    <!--<div class="item-title item-label">Test</div>-->
                    <!--<div class="item-input-wrap">-->
                    <!--&lt;!&ndash;<input name="birthday" type="date" value="2014-04-30"&ndash;&gt;-->
                    <!--&lt;!&ndash;placeholder="Please choose...">&ndash;&gt;-->
                    <!--&lt;!&ndash;</div>&ndash;&gt;-->
                    <!--&lt;!&ndash;<div class="item-input-wrap">&ndash;&gt;-->
                    <!--<input name="testTextValueAjax" type="text" id="testajax" placeholder="Please choose for test..."-->
                    <!--required validate>-->
                    <!--<span class="input-clear-button"></span>-->
                    <!--&lt;!&ndash;<div class="item-input-info">Default "required" validation</div>&ndash;&gt;-->
                    <!--&lt;!&ndash;<input type="email" name="email" placeholder="E-mail">&ndash;&gt;-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</div>-->
                    <!--</li>-->


                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Destination</div>
                                <div class="item-input-wrap">
                                    <input name="destination_name" id="EditDestination_autocomplete-dropdown-all"
                                           type="text"
                                           placeholder="Select your destination from here."
                                           required validate>

                                    <span class="input-clear-button"></span>
                                    <!--<div class="item-input-info">Default "required" validation</div>-->
                                    <!--<input type="text" name="name" placeholder="Your name">-->
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Car Number</div>
                                <div class="item-input-wrap">
                                    <input name="car_name" id="EditCar_autocomplete-dropdown-all" type="text"
                                           placeholder="Car Number."
                                           required validate value=>


                                    <span class="input-clear-button"></span>
                                    <!--<div class="item-input-info">Default "required" validation</div>-->
                                    <!--<input type="text" name="name" placeholder="Your name">-->
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Pick Up Form</div>
                                <div class="item-input-wrap">
                                    <input name="pickUpLocationName" id="EditPickUPLocation_autocomplete-dropdown-all"
                                           type="text"
                                           placeholder="Specify pick Up Location."
                                           required validate value=>


                                    <span class="input-clear-button"></span>
                                    <!--<div class="item-input-info">Default "required" validation</div>-->
                                    <!--<select name="gender" placeholder="Please choose...">-->
                                    <!--<option value="Male">Male</option>-->
                                    <!--<option value="Female">Female</option>-->
                                    <!--</select>-->
                                    <!--<input type="text" name="name" placeholder="Your name">-->
                                </div>
                            </div>
                        </div>
                    </li>
                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <!--<div class="item-title item-label">E-mail</div>-->
                                <div class="item-title item-label">Return Time</div>
                                <div class="item-input-wrap">
                                    <!--<input name="birthday" type="date" value="2014-04-30"-->
                                    <!--placeholder="Please choose...">-->
                                    <!--</div>-->
                                    <!--<div class="item-input-wrap">-->
                                    <input name="returnTime" type="date" id="returnDate" placeholder="mm/dd/yyyy"
                                           value="2014-04-30"
                                           required validate>
                                    <span class="input-clear-button"></span>
                                    <!--<div class="item-input-info">Default "required" validation</div>-->
                                    <!--<input type="email" name="email" placeholder="E-mail">-->
                                </div>
                            </div>
                        </div>
                    </li>


                    <li>
                        <div class="item-content item-input">
                            <div class="item-inner">
                                <div class="item-title item-label">Number of Passengers</div>
                                <div class="item-input-wrap">
                                    <!--<select name="gender">-->
                                    <!--<option value="male" selected>Male</option>-->
                                    <!--<option value="female">Female</option>-->
                                    <!--</select>-->

                                    <!--<input type="text" placeholder="Your name" required validate>-->


                                    <input name="number_of_passanger" id="passangers" type="number" required validate
                                           pattern="[0-9]*" data-error-message="Only numbers please!"
                                           placeholder="Enter number of passengers.">
                                    <span class="input-clear-button"></span>
                                    <!--<div class="item-input-info">Default "required" validation</div>-->
                                </div>
                            </div>
                        </div>
                    </li>


                </ul>

                <input type="submit" class="button" @click="updateBooking()" value="Update Vehicle booking">
                <!--onclick="xq()"-->

                <!--@click="signIn"-->
            </form>
        </div>
    </div>
</template>


<script src="../dist/js/framework7.min.js"></script>

<script src="js/routes.js"></script>
<script src="js/app.js"></script>
<script src="js/jquery-3.2.1.js"></script>

<script>

    // console.log("At booking edit.html");
    "use strict";

    var $ = this.$;
    var editdata;


    // no need requres when accessing html pages in ./pages section.
    // var app = this.$app;
    //var app = new Framework7();


    // $(document).ready(function () {
    //     console.log("ready at editbooking.html!");
    // });


    var $$ = Dom7;
    var selectedChoices = [];


    app.on('pageInit', function (e, page) {


            var selection = {
                id: 0,
                selectedText: "Doe",
                selectedValue: 0,
                autocompleteId: ""
            };


            // console.log(editdata);

            // console.log(editdata.destinationName);


            var userid = parseInt(app.data.user.userid) === 0 ? 1 : app.data.user.userid;


            var bookings_id = parseInt(app.data.bookings.id) === 0 ? 29 : app.data.bookings.id;

            // console.log(userid);
            //
            // console.log(bookings_id);


            // return;


            if (userid) {


                // var table = "bookings";
                // var userid = app.data.user.userid;

                // var userid = 1;


                app.request.post('../editbooking.php', {

                        userid: userid,
                        bookings_id: bookings_id,
                    }, function (data) {


                        // console.log(data);


                        var x = JSON.parse(data);
                        //console.log(x);

                        var editbookingsData = x.message;


                        editbookingsData = JSON.parse(editbookingsData);

                        editdata = editbookingsData[0];


                        console.log(editdata);
                        console.log(editdata.ReturnTime);

                        var date = new Date(editdata.ReturnTime);


                        var d = new Date();
                        var month = new Array();
                        month[0] = "01";
                        month[1] = "02";
                        month[2] = "03";
                        month[3] = "04";
                        month[4] = "05";
                        month[5] = "06";
                        month[6] = "07";
                        month[7] = "08";
                        month[8] = "09";
                        month[9] = "10";
                        month[10] = "11";
                        month[11] = "12";


                        var month = month[date.getMonth()];
                        var day = date.getDate();
                        var year = date.getFullYear();

                        d = year + '-' + month + '-' + day;

                        $$('#EditPickUPLocation_autocomplete-dropdown-all').val(editdata.PickUpLocationName);

                        $$('#EditDestination_autocomplete-dropdown-all').val(editdata.destinationName);
                        $$('#EditCar_autocomplete-dropdown-all').val(editdata.CarName);
                        $$('#passangers').val(editdata.PassengerNumber);
                        $$('#returnDate').val(d);

                        // var selectedChoices = [];


                        // var selectedValue = {"testajax": value};
                        selection = {
                            id: 1,
                            selectedText: editdata.PickUpLocationName,
                            selectedValue: editdata.PickUpLocationId,
                            autocompleteId: "EditPickUPLocation_autocomplete-dropdown-all"
                        };
                        selectedChoices[0] = selection;


                        // var selectedValue = {"testajax": value};
                        selection = {
                            id: 2,
                            selectedText: editdata.destinationName,
                            selectedValue: editdata.destinationId,
                            autocompleteId: "EditDestination_autocomplete-dropdown-all"
                        };
                        // alldata.push(selectedValue);
                        // console.log(selection);

                        selectedChoices[1] = selection;


                        selection = {
                            id: 3,
                            selectedText: editdata.CarName,
                            selectedValue: editdata.CarId,
                            autocompleteId: "EditCar_autocomplete-dropdown-all"
                        };
                        // alldata.push(selectedValue);
                        // console.log(selection);

                        selectedChoices[2] = selection;

                        console.log("selectedChoices at 328: ");
                        console.log(selectedChoices);

                    },
                    function (data) {
                        console.log("error");
                    }
                );

            }


            // Dropdown with all values for car
            self.autocompleteDropdownAllcar = app.autocomplete.create({
                inputEl: '#EditCar_autocomplete-dropdown-all',
                openIn: 'dropdown',
                valueProperty: 'name', //object's "value" property name
                textProperty: 'name', //object's "text" property name


                source: function (query, render) {
                    var table = "car";

                    app.request.post('../cars.php/', {table: table}, function (data) {
                            carnames = [];
                            carnames.length = 0;
                            carResuls = [];
                            carResuls.length = 0;

                            // x = JSON.parse(data);

                            // IMPORTANT for DEBUG PURPOSE, THAT YOU PRINT data FRIST BEFORE USING JSON.parse(data)
                            // console.log(data);

                            var x = JSON.parse(data);

                            //console.log(x);
                            data = x.message;
                            cars = data;


                            cars = JSON.parse((cars));


                            $.each(cars, function (index, onedata) {

                                carnames.push(onedata);

                            });

                            // console.log(carnames);
                            // console.log(carnames.length);

                            if (query.length === 0) {

                                // console.log(carnames);
                                // console.log(carnames.length);

                                for (var i = 0; i < carnames.length; i++) {
                                    if (carnames[i].name.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                                        carResuls.push(carnames[i]);
                                }

                                // console.log(carResuls);

                                // console.log(destinationresults.length);

                                render(carResuls);

                                return;
                            }

                            //console.log(destinationresults.length);

                            // Find matched items
                            for (var i = 0; i < carnames.length; i++) {
                                if (carnames[i].name.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                                    carResuls.push(carnames[i]);
                            }
                            // Render items by passing array with result items
                            render(carResuls);
                            // return;


                        },
                        function (data) {
                            console.log("error");

                        }
                    );

                    //console.log(results);
                },
                on: {
                    change: function (value) {

                        // console.log(value);

                        // var selectedValue = {"testajax": value};
                        selection = {
                            id: 4,
                            selectedText: value[0].name,
                            selectedValue: value[0].id,
                            autocompleteId: "Car_autocomplete-dropdown-all"
                        };
                        // alldata.push(selectedValue);
                        // console.log(selection);

                        selectedChoices[2] = selection;

                        // console.log(selectedChoices);

                    },

                },
            });


            var autocompleteDropdownAlldes = app.autocomplete.create({
                    inputEl: '#EditDestination_autocomplete-dropdown-all',
                    openIn: 'dropdown',
                    valueProperty: 'value', //object's "value" property name
                    textProperty: 'value', //object's "text" property name
                    value: ['xx', 'tt'],


                    source: function (query, render) {
                        var table = "location";
                        // destinationvalues=[];

                        app.request.post('../functions.php/', {table: table}, function (data) {
                                destinationvalues = [];
                                destinationvalues.length = 0;

                                destinationResults = [];
                                destinationResults.length = 0;

                                // x = JSON.parse(data);

                                // IMPORTANT for DEBUG PURPOSE, THAT YOU PRINT data FRIST BEFORE USING JSON.parse(data)
                                // console.log(data);

                                var x = JSON.parse(data);

                                // console.log(x.value);
                                data = x.message;
                                destinatinoLocations = data;

                                // console.log(destinatinoLocations);

                                destinatinoLocations = JSON.parse((destinatinoLocations));

                                // console.log(destinationresults.length);


                                // return;


                                var alldestinations = "";

                                $.each(destinatinoLocations, function (index, onedata) {


                                    destinationvalues.push(onedata);
                                    // destinationvalues.push(onedata.value);

                                });

                                // console.log(inputEl);
                                // console.log(inputEl);
                                // console.log(inputEl);

                                // console.log(destinationvalues);
                                // console.log(destinationvalues.length);
                                if (query.length === 0) {

                                    for (var i = 0; i < destinationvalues.length; i++) {
                                        if (destinationvalues[i].value.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                                            destinationResults.push(destinationvalues[i]);
                                    }

                                    render(destinationResults);

                                    return;
                                }

                                //console.log(destinationresults.length);

                                // Find matched items
                                for (var i = 0; i < destinationvalues.length; i++) {
                                    if (destinationvalues[i].value.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                                        destinationResults.push(destinationvalues[i]);
                                }
                                // Render items by passing array with result items
                                render(destinationResults);

                                return;

                            },
                            function (data) {
                                console.log("error");

                            }
                        );


                        //console.log(results);
                    },

                    on: {
                        change: function (value) {
                            // console.log(value);

                            // var selectedValue = {"testajax": value};
                            selection = {
                                id: 3,
                                selectedText: value[0].value,
                                selectedValue: value[0].id,
                                autocompleteId: "Destination_autocomplete-dropdown-all"
                            };
                            // alldata.push(selectedValue);
                            // console.log(selection);

                            selectedChoices[1] = selection;

                            // console.log(selectedChoices);
                        },

                    },


                }
            );
            // console.log(this.inputEl);
            //
            // console.log(this.inputEl);


            // Dropdown with all values for destination
            self.autocompleteDropdownAllpick = app.autocomplete.create({

                    inputEl: '#EditPickUPLocation_autocomplete-dropdown-all',
                    openIn: 'dropdown',
                    valueProperty: 'pickUpLoc', //object's "value" property name
                    textProperty: 'pickUpLoc', //object's "text" property name


                    source: function (query, render) {
                        var table = "pickuplocation";
                        app.request.post('../pickingLocation.php/', {table: table}, function (data) {
                                pickUpLocationValues = [];
                                pickUpLocationValues.length = 0;

                                pickUpResults = [];
                                pickUpResults.length = 0;


                                // console.log(query);
                                // console.log(render);


                                // x = JSON.parse(data);

                                // IMPORTANT for DEBUG PURPOSE, THAT YOU PRINT data FRIST BEFORE USING JSON.parse(data)
                                //console.log(data);

                                //return;

                                var x = JSON.parse(data);

                                // console.log(x.value);
                                data = x.message;
                                pickUpLocations = data;

                                // console.log(destinatinoLocations);

                                pickUpLocations = JSON.parse((pickUpLocations));

                                // console.log(destinationresults.length);

                                // return;

                                var alldestinations = "";

                                $.each(pickUpLocations, function (index, onedata) {


                                    pickUpLocationValues.push(onedata);
                                    // results.push(data[i])

                                    // pickUpLocationValues.push(onedata.pickUpLoc);
                                });

                                if (query.length === 0) {
                                    // alert("at query.length ==0");
                                    //means when the text field is empty.


                                    //console.log(pickUpLocationValues);
                                    //return;


                                    for (var i = 0; i < pickUpLocationValues.length; i++) {
                                        if (pickUpLocationValues[i].pickUpLoc.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                                            pickUpResults.push(pickUpLocationValues[i]);
                                    }


                                    // if (data[i].name.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                                    //     results.push(data[i]);

                                    //console.log(destinationvalues);
                                    // console.log(destinationvalues.length);


                                    console.log(pickUpResults[2]);
                                    render(pickUpResults);
                                    // render({id: "4", pickUpLoc: "Cox's Bazar, Chittagong"});
                                    // render({pickUpLoc: "4", pickUpLoc: "Cox's Bazar, Chittagong"});

                                    // render(pickUpLocationValues[2]);
                                    // console.log(pickUpLocationValues[2]);


                                    return;
                                }

                                //console.log(destinationresults.length);

                                // Find matched items

                                // console.log(pickUpLocationValues);
                                for (var i = 0; i < pickUpLocationValues.length; i++) {

                                    // console.log("at query.length not equal to 0");
                                    // console.log(data[i].pickUpLoc);
                                    if (pickUpLocationValues[i].pickUpLoc.toLowerCase().indexOf(query.toLowerCase()) >= 0)
                                        pickUpResults.push(pickUpLocationValues[i]);

                                    // console.log(pickUpLocationValues[i]);


                                }
                                // Render items by passing array with result items

                                // console.log(pickUpLocationValues[2]);
                                // render(pickUpLocationValues[2]);

                                // render({id: "4", pickUpLoc: "Cox's Bazar, Chittagong"});

                                // console.log(render(pickUpResults));
                                render(pickUpResults);

                                return;
                            },
                            function (data) {
                                console.log("error");

                            }
                        );


                    },
                    on: {
                        change: function (value) {
                            // console.log(value);

                            // var selectedValue = {"testajax": value};
                            selection = {
                                id: 2,
                                selectedText: value[0].pickUpLoc,
                                selectedValue: value[0].id,
                                autocompleteId: "PickUPLocation_autocomplete-dropdown-all"
                            };
                            // alldata.push(selectedValue);
                            // console.log(selection);

                            selectedChoices[0] = selection;

                            // console.log(selectedChoices);

                        },

                    },
                }
            );


        }
    );

    // app.on('pageBeforeRemove', function (page) {
    //
    //     var self = this;
    //     // Destroy all autocompletes
    //     self.autocompleteDropdownAll.destroy();
    // });


    app.on('pageAfterIn', function (page) {


        // $$('#returnDate').val();
        var logger_info = "you are (usermail):" + app.data.user.userEmail;
        // console.log("oooo:");
        // $$('#userinfo').html(logger_info);


        // autocompleteDropdownAlldes.value="wer";
        // document.getElementById('userInfo').html


        // do something after page gets into the view\n' +
    });


    // DON'T REMOVE THIS......

    // noinspection JSAnnotator
    return {

        data: function () {
            var ios = this.$theme.ios;

            return {
                commentsIcon: ios ? '<i class="icon f7-icons">chat_fill</i>' : '<i class="icon material-icons">message</i>',
                sortIcon: ios ? '<i class="icon f7-icons">sort</i>' : '<i class="icon material-icons">sort</i>',
                moreIcon: ios ? '<i class="icon f7-icons">more_vertical_round</i>' : '<i class="icon material-icons">more_vert</i>',
                trashIcon: ios ? '<i class="icon f7-icons">trash</i>' : '<i class="icon material-icons">delete</i>',
                composeIcon: ios ? '<i class="icon f7-icons">compose</i>' : '<i class="icon material-icons">edit</i>'
            }
        },


        methods: {
            updateBooking: function () {
                console.log("updateBooking");


                var bookings_id = parseInt(app.data.bookings.id) === 0 ? 29 : parseInt(app.data.bookings.id);
                // var bookings_id= app.data.bookings.bookings_id;

                var booking_date = app.data.bookings.booking_date === 0 ? '2017-04-30' : app.data.bookings.booking_date;


                // DOESN'T WORK THESE BELOW
                // var replyText = $('#passangers').val();
                //


                // This one works
                var passanger_number = parseInt($$('#passangers').val());

                // console.log(passanger_number);

                var returnDate = $$('#returnDate').val();

                // console.log(returnDate );

                // name="testTextValueAjax" type="text" id="testajax"
                // var keyvalue = $$('#testajax').val();

                // console.log(keyvalue);

                // app.form.storeFormData

                // var formData1 = app.form.getFormData('my-form')
                // alert(JSON.stringify(formData1));

                // console.log("selected Choices at 797: ");
                //
                // console.log(selectedChoices);
                //
                // console.log(booking_date);


                // console.log("line803");

                var ddldata = JSON.stringify(selectedChoices);

                // console.log(ddldata);

                // app.dialog.alert('Final: !');


                // $$('#anim').css({left: left + 'px'})
                // animId = app.utils.requestAnimationFrame(anim);
                // console.log("LOG");

                var table = "bookings";


                var userid = parseInt(app.data.user.userid) === 0 ? 1 : app.data.user.userid;


                console.log(table);
                console.log(ddldata);
                console.log("return Date: ")
                console.log(returnDate);
                console.log("booking Date: ")
                console.log(booking_date);
                console.log(passanger_number);
                console.log(bookings_id);
                // console.log("line 823");

                app.request.post('../updateVehicleBooking.php/', {
                        table: table,
                        data: ddldata,
                        returnDate: returnDate,
                        passangerNumber: passanger_number,
                        booking_date: booking_date,
                        bookings_id: bookings_id,
                        userid: userid,
                    }, function (reserveData) {


                        console.log(reserveData);


                        var x = JSON.parse(reserveData);


                        if (x.value === 1) {

                            // console.log(selectedChoices[0]);

                            app.dialog.alert('<b>Congratulatoin, ' + app.data.user.userEmail + ' your bookings were updaed, please check.</b>');


                            return app.router.navigate('/yourbooking/');

                        }
                        ;


                    },
                    function (data) {
                        console.log("error");

                    });


            }

        }

    }


</script>

